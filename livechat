<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>লাইভ হেল্পলাইন সিস্টেম</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
  body { font-family: 'Arial', sans-serif; background:#f5f5f5; margin:0; padding:0; display:flex; justify-content:center; align-items:center; height:100vh; }
  .container { width:350px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); overflow:hidden; }
  .header { background:#007bff; color:#fff; padding:10px; text-align:center; display:flex; justify-content:space-between; align-items:center; }
  .header h2 { margin:0; font-size:18px; }

  .panel { display:none; padding:20px; text-align:center; }
  .panel.active { display:block; }

  .btn { background:#007bff; color:#fff; padding:10px; margin-top:10px; border:none; width:100%; border-radius:5px; cursor:pointer; }
  .btn:hover { background:#0056b3; }

  .popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
  .popup.active { display:flex; }
  .popup-content { background:#fff; padding:20px; border-radius:10px; width:300px; text-align:center; position:relative; }
  .popup-content i.fa-xmark { position:absolute; top:10px; right:10px; cursor:pointer; font-size:18px; color:#555; }

  input { width:100%; padding:8px; margin:5px 0; border:1px solid #ccc; border-radius:5px; }

  /* Chat Box */
  .chat-box { display:flex; flex-direction:column; height:400px; }
  .chat-header { background:#007bff; color:#fff; padding:10px; display:flex; align-items:center; }
  .chat-header i { font-size:18px; cursor:pointer; margin-right:10px; }
  .chat-messages { flex:1; padding:10px; overflow-y:auto; background:#f0f0f0; }
  .chat-message { margin:5px 0; max-width:80%; padding:8px; border-radius:8px; font-size:14px; position:relative; }
  .chat-message.user { background:#007bff; color:#fff; margin-left:auto; text-align:right; }
  .chat-message.admin { background:#e0e0e0; color:#000; margin-right:auto; text-align:left; }
  .chat-time { font-size:10px; color:#333; margin-top:3px; }

  .chat-input { display:flex; padding:10px; background:#fff; border-top:1px solid #ccc; }
  .chat-input input { flex:1; margin-right:5px; }
  .chat-input button { background:#007bff; color:#fff; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; }

  /* Chat List */
  .chat-list { max-height:300px; overflow-y:auto; padding:10px; } /* স্ক্রলবার যোগ */
  .chat-item { display:flex; justify-content:space-between; align-items:center; background:#f0f0f0; padding:10px; margin-bottom:5px; border-radius:5px; cursor:pointer; }
  .chat-item.unread { background:#ffdddd; } /* নতুন মেসেজ লাল */
  .chat-item i { cursor:pointer; }
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <h2>হেল্পলাইন লাইভ চ্যাট</h2>
  </div>

  <div class="panel active" id="home-panel">
    <button class="btn" onclick="openPopup('user')"><i class="fa-solid fa-headset"></i> কাষ্টমার হেল্প</button>
    <button class="btn" onclick="openPopup('admin')"><i class="fa-solid fa-toolbox"></i> এডমিন এর কার্জালয়</button>
  </div>

  <div class="panel" id="user-chat"></div>
  <div class="panel" id="chat-list"></div>
  <div class="panel" id="admin-chat"></div>

</div>

<!-- ইউজার লগইন পপআপ -->
<div class="popup" id="popup">
  <div class="popup-content">
    <i class="fa-solid fa-xmark" onclick="closePopup('popup')"></i>
    <h3 id="popup-title">হেল্প নিন</h3>
    <input type="text" id="popup-name" placeholder="নাম লিখুন">
    <input type="text" id="popup-id" placeholder="আইডি নাম্বার দিন">
    <button class="btn" onclick="submitPopup()">শুরু করুন</button>
  </div>
</div>

<!-- অ্যাডমিন কোড পপআপ -->
<div class="popup" id="admin-code-popup">
  <div class="popup-content">
    <i class="fa-solid fa-xmark" onclick="closePopup('admin-code-popup')"></i>
    <h3>অ্যাডমিন কোড দিন</h3>
    <input type="password" id="admin-code" placeholder="Admin Code">
    <button class="btn" onclick="checkAdmin()">লগইন</button>
  </div>
</div>

<script>
  const popup = document.getElementById('popup');
  const adminCodePopup = document.getElementById('admin-code-popup');
  const panels = document.querySelectorAll('.panel');
  const ADMIN_CODE = "16064154";

  let currentUserId = null;
  let chatData = JSON.parse(localStorage.getItem('chatData')) || {};

  function openPopup(type) {
    if (type === 'user') popup.classList.add('active');
    else adminCodePopup.classList.add('active');
  }

  function closePopup(id) {
    document.getElementById(id).classList.remove('active');
  }

  function submitPopup() {
    const id = document.getElementById('popup-id').value.trim();
    if (!id) return alert('আইডি দিন');
    currentUserId = id;
    popup.classList.remove('active');
    openUserChat();
  }

  function checkAdmin() {
    const code = document.getElementById('admin-code').value;
    if (code === ADMIN_CODE) {
      adminCodePopup.classList.remove('active');
      openChatList();
    } else {
      alert('ভুল কোড!');
    }
  }

  function showPanel(id) {
    panels.forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function openUserChat() {
    showPanel('user-chat');
    renderChatBox('user', currentUserId);
  }

  function openChatList() {
    showPanel('chat-list');
    renderChatList();
  }

  function openAdminChat(id) {
    currentUserId = id;
    showPanel('admin-chat');
    renderChatBox('admin', id);
    if (chatData[id]) chatData[id].unread = false; // নতুন মেসেজ দেখলে লাল অপ্রদর্শিত হবে
    saveChat();
  }

  function renderChatList() {
  const div = document.getElementById('chat-list');
  let html = `<div class="chat-header"><i class="fa-solid fa-arrow-left" onclick="showPanel('home-panel')"></i><h3>চ্যাট লিস্ট</h3></div><div class="chat-list">`;

  // unread উপরে, replied নিচে
  const ids = Object.keys(chatData);
  ids.sort((a, b) => {
    const unreadA = chatData[a].unread ? 1 : 0;
    const unreadB = chatData[b].unread ? 1 : 0;
    return unreadB - unreadA;
  });

  for (let id of ids) {
    const unread = chatData[id].unread ? 'unread' : '';
    html += `<div class="chat-item ${unread}" onclick="openAdminChat('${id}')">
      <span>${id}</span>
      <i class="fa-solid fa-trash" style="color:red; cursor:pointer;" onclick="event.stopPropagation(); confirmDelete('${id}')"></i>
    </div>`;
  }
  html += `</div>`;
  div.innerHTML = html;
}

  function renderChatBox(mode, id) {
    const div = document.getElementById(mode === 'user' ? 'user-chat' : 'admin-chat');
    let name = mode === 'user' ? 'আপনি' : id;
    let html = `<div class="chat-header"><i class="fa-solid fa-arrow-left" onclick="showPanel('${mode === 'user' ? 'home-panel' : 'chat-list'}')"></i><h3>${name}</h3></div>
    <div class="chat-box">
      <div class="chat-messages" id="chat-${mode}-messages"></div>
      <div class="chat-input">
        <input type="text" id="chat-${mode}-input" placeholder="মেসেজ লিখুন...">
        <button onclick="sendMessage('${mode}')"><i class="fa-solid fa-paper-plane"></i></button>
      </div>
    </div>`;
    div.innerHTML = html;
    renderMessages(mode, id);
  }

  function renderMessages(mode, id) {
  const messagesDiv = document.getElementById(`chat-${mode}-messages`);
  messagesDiv.innerHTML = '';
  const messages = chatData[id]?.messages || [];
  messages.forEach(msg => {
    const align = msg.sender === 'user' ? 'user' : 'admin';
    messagesDiv.innerHTML += `
      <div class="chat-message ${align}">
        ${msg.text}
        <div class="chat-time">${msg.time} | ${msg.date}</div>
      </div>`;
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function sendMessage(mode) {
  const input = document.getElementById(`chat-${mode}-input`);
  const text = input.value.trim();
  if (!text) return;

  const now = new Date();
  const time = now.toLocaleTimeString();      // সময়
  const date = now.toLocaleDateString();      // তারিখ

  if (!chatData[currentUserId]) chatData[currentUserId] = { messages: [], unread: false };

  chatData[currentUserId].messages.push({ sender: mode, text, time, date });
  if (mode === 'user') chatData[currentUserId].unread = true; // unread লাল
  saveChat();
  input.value = '';
  renderMessages(mode, currentUserId);
  renderChatList();
}

  function confirmDelete(id) {
    if (confirm(`আপনি কি ${id} আইডির চ্যাট ডিলিট করতে চান?`)) {
      deleteChat(id);
    }
  }

  function deleteChat(id) {
    delete chatData[id]; // শুধুমাত্র ID মুছে যাবে, মেসেজ লোকালস্টোরেজে থাকবে
    saveChat();
    renderChatList();
  }

  function saveChat() {
    localStorage.setItem('chatData', JSON.stringify(chatData));
  }
</script>

</body>
</html>
